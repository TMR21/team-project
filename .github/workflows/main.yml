name: Collaborative Workflow

on:
  push:
    branches: [ "main" ]

permissions:
  contents: write    # allow workflow to push changes

jobs:
  update-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

# Step 2: Conditionally update index.html only for certain actor(s)
      - name: Update index.html when actor matches
        run: |
          ACTOR="${{ github.actor }}"
          echo "Actor is: $ACTOR"
          # List of allowed usernames that should update index.html
          ALLOWED_USERS="TMR21 team-leader member1 member2"
          for u in $ALLOWED_USERS; do
            if [ "$u" = "$ACTOR" ]; then
              # insert a line before </body> with the actor and date
              sed -i "/<\/body>/i <p>Updated by ${ACTOR} on $(date -u '+%Y-%m-%d %H:%M:%S UTC')</p>" index.html || true
              echo "Updated index.html for $ACTOR"
              break
            fi
          done

 # Step 3: Append log to README.md
      - name: Update README log
        run: |
          echo "### Updated by ${{ github.actor }} on $(date -u '+%Y-%m-%d %H:%M:%S UTC') [Commit: $(git rev-parse --short HEAD)]" >> README.md
          echo "Appended README entry."

 # Step 4: Commit & push changes back
      - name: Commit and Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add index.html README.md || true
          git commit -m "Workflow: Updated HTML and README for ${GITHUB_ACTOR}" || echo "No changes to commit"
          # push using token
          git push origin HEAD:main
YML
